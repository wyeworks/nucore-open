= content_for :head_content do
  = javascript_include_tag "price_policy"

- price_policy = @price_policies.first
= render "price_policies/common_fields", f: f, price_policy: price_policy

%table.table.table-striped.table-hover.price-policy-table
  %thead
    %tr
      %th= PriceGroup.model_name.human
      %th= price_policy.class.human_attribute_name(:type)
      %th= price_policy.class.human_attribute_name(:can_purchase)
      %th.centered= price_policy.class.human_attribute_name(:unit_cost)
      %th.centered= price_policy.class.human_attribute_name(:unit_adjustment)
  %tbody
    - @price_policies.each do |price_policy|
      - price_group = price_policy.price_group
      = fields_for "price_policy_#{price_group.id}", price_policy do |pp|
        - row_class = []
        - row_class << "js--masterInternalRow" if price_group.master_internal?
        - row_class << "js--adjustmentRow" if price_group.shows_adjustment_input?
        - row_class << "js--externalSubsidyRow" if price_group.external_subsidy?
        %tr{class: row_class, data: price_group.external_subsidy? ? { parent_price_group_id: price_group.parent_price_group_id } : {}}
          %td= price_group.name
          %td= price_group.type_string
          %td= pp.check_box :can_purchase, class: "js--canPurchase"
          - if price_group.external? && !price_group.shows_adjustment_input?
            %td.centered
              = pp.text_field :unit_cost, value: number_to_currency(price_policy.unit_cost, unit: "", delimiter: ""),
                size: 8,
                data: { price_group_id: price_group.id }
            %td.centered
          - elsif price_group.master_internal?
            %td.centered
              = pp.text_field :unit_cost, value: number_to_currency(price_policy.unit_cost, unit: "", delimiter: ""),
                size: 8,
                data: { target: ".js--unitRate" }
            %td
          - else
            %td.centered
              %span.unit_cost
              = pp.hidden_field :unit_cost, value: number_to_currency(price_policy.unit_cost, unit: "", delimiter: ""),
                class: "js--unitRate", readonly: true
            %td.centered
              = pp.text_field :unit_subsidy, value: number_to_currency(price_policy.unit_subsidy, unit: "", delimiter: ""),
                size: 8
