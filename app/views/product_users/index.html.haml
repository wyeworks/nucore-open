= content_for :h1 do
  = current_facility

= content_for :sidebar do
  = render "admin/shared/sidenav_product",
    sidenav_tab: @product.class.name.pluralize.underscore

= content_for :tabnav do
  = render "admin/shared/tabnav_product", secondary_tab: "users"

%h2= @product
%h3= text("header")

.well.well-small
  = simple_form_for :product_user_import, url: facility_product_product_user_imports_path(current_facility, @product), html: { multipart: true } do |f|
    %p= text("import_hint", product_type: @product.model_name.human.downcase)
    .row
      %p.span2= link_to text("add"), [:new, current_facility, @product, :user], class: "btn-add"
      %label.span2.btn.btn-primary
        = text("import_button")
        %span{ style:"display:none" }= f.file_field :file, onchange: "form.submit()"

- if @product_users.present?
  = form_tag polymorphic_path([current_facility, @product, :users], format: :csv), method: :get, class: "search_form" do
    = hidden_field_tag :email, current_user.email, disabled: true
    = hidden_field_tag :format, params[:format], disabled: true

  = link_to t("reports.product_users.export"), url_for(format: :csv), class: "js--exportSearchResults pull-right", data: { form: ".search_form", action: "export_csv" }

- if @product_users.present? || @search_action_performed
  -# TODO: Use i8n
  = form_tag polymorphic_path([:search, current_facility, @product, :users]), id: "ajax_form", method: :get, data: { "hide-target": "data-action='export_csv'" } do
    = label_tag :access_list_search, text("search_form.label")
    = text_field_tag :search, nil, size: 50, class: "search-query", id: "access_list_search"
    = submit_tag text("search_form.button"), class: "btn"
= render "users_results"
