= content_for :h1 do
  = current_facility

- if current_ability.can?(:create, Estimate)
  %p= link_to t(".add"), new_facility_estimate_path, class: "btn-add"

.row
  .form-horizontal
    = form_tag facility_estimates_path, method: :get, class: "form-horizontal filter-form" do
      .form-group
        %label.col-sm-2.control-label= t(".search")
        .col-sm-3
          = text_field_tag :search, params[:search], placeholder: t(".search_placeholder"), id: "estimate_search", class: "form-control"

      .form-group
        %label.col-sm-2.control-label= t(".filter_user")
        .col-sm-3
          = select_tag :user_id,
            options_for_select(estimate_user_options(current_facility),
            selected: params[:user_id]), class: "form-control"

      .form-group
        %label.col-sm-2.control-label= t(".hide_expired")
        .col-sm-3
          = check_box_tag :hide_expired, "1", params[:hide_expired] == "1"

      .form-group
        .col-sm-offset-2.col-sm-3
          = submit_tag t("shared.filter"), class: "btn btn-default"
          = link_to t(".clear_filter"), facility_estimates_path, class: "btn btn-default"

- if @estimates.present?
  %table.table.table-striped.table-hover
    %thead
      %tr
        %th= Estimate.human_attribute_name(:id)
        %th= Estimate.human_attribute_name(:description)
        %th= Estimate.human_attribute_name(:user)
        %th= Estimate.human_attribute_name(:expires_at)
    %tbody
      - @estimates.each do |estimate|
        %tr{class: ("row-warning" if estimate.expires_at < Time.current)}
          %td= link_to estimate.id, facility_estimate_path(current_facility, estimate)
          %td= estimate.description
          %td= estimate.user_display_name
          %td= format_usa_date(estimate.expires_at)
- else
  %p.notice= t(".no_estimates")
