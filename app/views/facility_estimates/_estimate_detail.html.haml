%tr{ data: { estimate_detail_id: estimate_detail.id } }
  - index_to_use = estimate_detail.id.present? ? estimate_detail.id : temp_id
  - id_prefix = "estimate[estimate_details_attributes][#{index_to_use}]"
  - if estimate_detail.id.present?
    = hidden_field_tag "#{id_prefix}[id]", estimate_detail.id
  = hidden_field_tag "#{id_prefix}[product_id]", estimate_detail.product_id
  - if estimate_detail.duration_unit.present?
    = hidden_field_tag "#{id_prefix}[duration_unit]", estimate_detail.duration_unit
  
  - price_policy_id = estimate_detail.price_policy_id || PricePolicy.first&.id
  = hidden_field_tag "#{id_prefix}[price_policy_id]", price_policy_id
  
  = hidden_field_tag "#{id_prefix}[_destroy]", "0", class: 'destroy-field', id: "destroy_#{index_to_use}"

  %td
    - product_name = estimate_detail.product.name
    - if estimate_detail.product.facility != current_facility
      - product_name = "#{product_name} (#{estimate_detail.product.facility.name})"
    = product_name
  %td= number_field_tag "#{id_prefix}[quantity]", estimate_detail.quantity || 1, min: 1, style: "width: 3em;"
  %td
    - time_unit = estimate_detail.product.time_unit
    - if time_unit == "days"
      = number_field_tag "#{id_prefix}[duration]", estimate_detail.duration || 1, min: 1
    - elsif time_unit == "mins"
      - mins_value = estimate_detail.duration.present? ? estimate_detail.duration : "0:01"
      = text_field_tag "#{id_prefix}[duration]", mins_value, class: "js--estimate-duration-mins"
  %td.text-center
    %button.btn.btn-danger.btn-sm.remove-estimate-detail{type: "button", title: t("facility_estimates.show.remove")}
      = t("facility_estimates.show.remove")
